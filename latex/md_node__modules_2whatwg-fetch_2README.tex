\chapter{window.\+fetch polyfill}
\hypertarget{md_node__modules_2whatwg-fetch_2README}{}\label{md_node__modules_2whatwg-fetch_2README}\index{window.fetch polyfill@{window.fetch polyfill}}
\label{md_node__modules_2whatwg-fetch_2README_autotoc_md29897}%
\Hypertarget{md_node__modules_2whatwg-fetch_2README_autotoc_md29897}%
 \href{https://securityscorecards.dev/viewer/?uri=github.com/JakeChampion/fetch}{\texttt{ }}

The {\ttfamily fetch()} function is a Promise-\/based mechanism for programmatically making web requests in the browser. This project is a polyfill that implements a subset of the standard \href{https://fetch.spec.whatwg.org}{\texttt{ Fetch specification}}, enough to make {\ttfamily fetch} a viable replacement for most uses of XMLHttp\+Request in traditional web applications.\hypertarget{md_node__modules_2whatwg-fetch_2README_autotoc_md29898}{}\doxysection{\texorpdfstring{Table of Contents}{Table of Contents}}\label{md_node__modules_2whatwg-fetch_2README_autotoc_md29898}

\begin{DoxyItemize}
\item Read this first
\item \doxylink{md_node__modules_2web-vitals_2README_installation}{Installation}
\item \doxylink{md_node__modules_2_0dtypes_2jest_2node__modules_2_0dsinclair_2typebox_2readme_usage}{Usage}
\begin{DoxyItemize}
\item Importing
\item HTML
\item JSON
\item Response metadata
\item Post form
\item Post JSON
\item File upload
\item Caveats
\begin{DoxyItemize}
\item Handling HTTP error statuses
\item Sending cookies
\item Receiving cookies
\item Redirect modes
\item Obtaining the Response URL
\item Aborting requests
\end{DoxyItemize}
\end{DoxyItemize}
\item Browser Support
\end{DoxyItemize}\hypertarget{md_node__modules_2whatwg-fetch_2README_autotoc_md29899}{}\doxysection{\texorpdfstring{Read this first}{Read this first}}\label{md_node__modules_2whatwg-fetch_2README_autotoc_md29899}

\begin{DoxyItemize}
\item If you believe you found a bug with how {\ttfamily fetch} behaves in your browser, please {\bfseries{don\textquotesingle{}t open an issue in this repository}} unless you are testing in an old version of a browser that doesn\textquotesingle{}t support {\ttfamily window.\+fetch} natively. Make sure you read this {\itshape entire} readme, especially the Caveats section, as there\textquotesingle{}s probably a known work-\/around for an issue you\textquotesingle{}ve found. This project is a {\itshape polyfill}, and since all modern browsers now implement the {\ttfamily fetch} function natively, {\bfseries{no code from this project}} actually takes any effect there. See Browser support for detailed information.
\item If you have trouble {\bfseries{making a request to another domain}} (a different subdomain or port number also constitutes another domain), please familiarize yourself with all the intricacies and limitations of \href{https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS}{\texttt{ CORS}} requests. Because CORS requires participation of the server by implementing specific HTTP response headers, it is often nontrivial to set up or debug. CORS is exclusively handled by the browser\textquotesingle{}s internal mechanisms which this polyfill cannot influence.
\item This project {\bfseries{doesn\textquotesingle{}t work under Node.\+js environments}}. It\textquotesingle{}s meant for web browsers only. You should ensure that your application doesn\textquotesingle{}t try to package and run this on the server.
\item If you have an idea for a new feature of {\ttfamily fetch}, {\bfseries{submit your feature requests}} to the \href{https://github.com/whatwg/fetch/issues}{\texttt{ specification\textquotesingle{}s repository}}. We only add features and APIs that are part of the \href{https://fetch.spec.whatwg.org}{\texttt{ Fetch specification}}.
\end{DoxyItemize}\hypertarget{md_node__modules_2whatwg-fetch_2README_autotoc_md29900}{}\doxysection{\texorpdfstring{Installation}{Installation}}\label{md_node__modules_2whatwg-fetch_2README_autotoc_md29900}

\begin{DoxyCode}{0}
\DoxyCodeLine{npm\ install\ whatwg-\/fetch\ -\/-\/save}

\end{DoxyCode}


You will also need a Promise polyfill for \href{https://caniuse.com/promises}{\texttt{ older browsers}}. We recommend \href{https://github.com/taylorhakes/promise-polyfill}{\texttt{ taylorhakes/promise-\/polyfill}} for its small size and Promises/\+A+ compatibility.\hypertarget{md_node__modules_2whatwg-fetch_2README_autotoc_md29901}{}\doxysection{\texorpdfstring{Usage}{Usage}}\label{md_node__modules_2whatwg-fetch_2README_autotoc_md29901}
\hypertarget{md_node__modules_2whatwg-fetch_2README_autotoc_md29902}{}\doxysubsection{\texorpdfstring{Importing}{Importing}}\label{md_node__modules_2whatwg-fetch_2README_autotoc_md29902}
Importing will automatically polyfill {\ttfamily window.\+fetch} and related APIs\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{import\ 'whatwg-\/fetch'}
\DoxyCodeLine{}
\DoxyCodeLine{window.fetch(...)}

\end{DoxyCode}


If for some reason you need to access the polyfill implementation, it is available via exports\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{import\ \{fetch\ as\ fetchPolyfill\}\ from\ 'whatwg-\/fetch'}
\DoxyCodeLine{}
\DoxyCodeLine{window.fetch(...)\ \ \ //\ use\ native\ browser\ version}
\DoxyCodeLine{fetchPolyfill(...)\ \ //\ use\ polyfill\ implementation}

\end{DoxyCode}


This approach can be used to, for example, use abort functionality in browsers that implement a native but outdated version of fetch that doesn\textquotesingle{}t support aborting.

For use with webpack, add this package in the {\ttfamily entry} configuration option before your application entry point\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{entry:\ ['whatwg-\/fetch',\ ...]}

\end{DoxyCode}
\hypertarget{md_node__modules_2whatwg-fetch_2README_autotoc_md29903}{}\doxysubsection{\texorpdfstring{HTML}{HTML}}\label{md_node__modules_2whatwg-fetch_2README_autotoc_md29903}

\begin{DoxyCode}{0}
\DoxyCodeLine{fetch('/users.html')}
\DoxyCodeLine{\ \ .then(function(response)\ \{}
\DoxyCodeLine{\ \ \ \ return\ response.text()}
\DoxyCodeLine{\ \ \}).then(function(body)\ \{}
\DoxyCodeLine{\ \ \ \ document.body.innerHTML\ =\ body}
\DoxyCodeLine{\ \ \})}

\end{DoxyCode}
\hypertarget{md_node__modules_2whatwg-fetch_2README_autotoc_md29904}{}\doxysubsection{\texorpdfstring{JSON}{JSON}}\label{md_node__modules_2whatwg-fetch_2README_autotoc_md29904}

\begin{DoxyCode}{0}
\DoxyCodeLine{fetch('/users.json')}
\DoxyCodeLine{\ \ .then(function(response)\ \{}
\DoxyCodeLine{\ \ \ \ return\ response.json()}
\DoxyCodeLine{\ \ \}).then(function(json)\ \{}
\DoxyCodeLine{\ \ \ \ console.log('parsed\ json',\ json)}
\DoxyCodeLine{\ \ \}).catch(function(ex)\ \{}
\DoxyCodeLine{\ \ \ \ console.log('parsing\ failed',\ ex)}
\DoxyCodeLine{\ \ \})}

\end{DoxyCode}
\hypertarget{md_node__modules_2whatwg-fetch_2README_autotoc_md29905}{}\doxysubsection{\texorpdfstring{Response metadata}{Response metadata}}\label{md_node__modules_2whatwg-fetch_2README_autotoc_md29905}

\begin{DoxyCode}{0}
\DoxyCodeLine{fetch('/users.json').then(function(response)\ \{}
\DoxyCodeLine{\ \ console.log(response.headers.get('Content-\/Type'))}
\DoxyCodeLine{\ \ console.log(response.headers.get('Date'))}
\DoxyCodeLine{\ \ console.log(response.status)}
\DoxyCodeLine{\ \ console.log(response.statusText)}
\DoxyCodeLine{\})}

\end{DoxyCode}
\hypertarget{md_node__modules_2whatwg-fetch_2README_autotoc_md29906}{}\doxysubsection{\texorpdfstring{Post form}{Post form}}\label{md_node__modules_2whatwg-fetch_2README_autotoc_md29906}

\begin{DoxyCode}{0}
\DoxyCodeLine{var\ form\ =\ document.querySelector('form')}
\DoxyCodeLine{}
\DoxyCodeLine{fetch('/users',\ \{}
\DoxyCodeLine{\ \ method:\ 'POST',}
\DoxyCodeLine{\ \ body:\ new\ FormData(form)}
\DoxyCodeLine{\})}

\end{DoxyCode}
\hypertarget{md_node__modules_2whatwg-fetch_2README_autotoc_md29907}{}\doxysubsection{\texorpdfstring{Post JSON}{Post JSON}}\label{md_node__modules_2whatwg-fetch_2README_autotoc_md29907}

\begin{DoxyCode}{0}
\DoxyCodeLine{fetch('/users',\ \{}
\DoxyCodeLine{\ \ method:\ 'POST',}
\DoxyCodeLine{\ \ headers:\ \{}
\DoxyCodeLine{\ \ \ \ 'Content-\/Type':\ 'application/json'}
\DoxyCodeLine{\ \ \},}
\DoxyCodeLine{\ \ body:\ JSON.stringify(\{}
\DoxyCodeLine{\ \ \ \ name:\ 'Hubot',}
\DoxyCodeLine{\ \ \ \ login:\ 'hubot',}
\DoxyCodeLine{\ \ \})}
\DoxyCodeLine{\})}

\end{DoxyCode}
\hypertarget{md_node__modules_2whatwg-fetch_2README_autotoc_md29908}{}\doxysubsection{\texorpdfstring{File upload}{File upload}}\label{md_node__modules_2whatwg-fetch_2README_autotoc_md29908}

\begin{DoxyCode}{0}
\DoxyCodeLine{var\ input\ =\ document.querySelector('input[type="{}file"{}]')}
\DoxyCodeLine{}
\DoxyCodeLine{var\ data\ =\ new\ FormData()}
\DoxyCodeLine{data.append('file',\ input.files[0])}
\DoxyCodeLine{data.append('user',\ 'hubot')}
\DoxyCodeLine{}
\DoxyCodeLine{fetch('/avatars',\ \{}
\DoxyCodeLine{\ \ method:\ 'POST',}
\DoxyCodeLine{\ \ body:\ data}
\DoxyCodeLine{\})}

\end{DoxyCode}
\hypertarget{md_node__modules_2whatwg-fetch_2README_autotoc_md29909}{}\doxysubsection{\texorpdfstring{Caveats}{Caveats}}\label{md_node__modules_2whatwg-fetch_2README_autotoc_md29909}

\begin{DoxyItemize}
\item The Promise returned from {\ttfamily fetch()} {\bfseries{won\textquotesingle{}t reject on HTTP error status}} even if the response is an HTTP 404 or 500. Instead, it will resolve normally, and it will only reject on network failure or if anything prevented the request from completing.
\item For maximum browser compatibility when it comes to sending \& receiving cookies, always supply the `credentials\+: \textquotesingle{}same-\/origin'\`{} option instead of relying on the default. See Sending cookies.
\item Not all Fetch standard options are supported in this polyfill. For instance, \`{}redirect\`{} and {\ttfamily cache} directives are ignored.
\item {\ttfamily keepalive} is not supported because it would involve making a synchronous XHR, which is something this project is not willing to do. See \href{https://github.com/github/fetch/issues/700\#issuecomment-484188326}{\texttt{ issue \#700}} for more information.
\end{DoxyItemize}\hypertarget{md_node__modules_2whatwg-fetch_2README_autotoc_md29910}{}\doxysubsubsection{\texorpdfstring{Handling HTTP error statuses}{Handling HTTP error statuses}}\label{md_node__modules_2whatwg-fetch_2README_autotoc_md29910}
To have {\ttfamily fetch} Promise reject on HTTP error statuses, i.\+e. on any non-\/2xx status, define a custom response handler\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{function\ checkStatus(response)\ \{}
\DoxyCodeLine{\ \ if\ (response.status\ >=\ 200\ \&\&\ response.status\ <\ 300)\ \{}
\DoxyCodeLine{\ \ \ \ return\ response}
\DoxyCodeLine{\ \ \}\ else\ \{}
\DoxyCodeLine{\ \ \ \ var\ error\ =\ new\ Error(response.statusText)}
\DoxyCodeLine{\ \ \ \ error.response\ =\ response}
\DoxyCodeLine{\ \ \ \ throw\ error}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{function\ parseJSON(response)\ \{}
\DoxyCodeLine{\ \ return\ response.json()}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{fetch('/users')}
\DoxyCodeLine{\ \ .then(checkStatus)}
\DoxyCodeLine{\ \ .then(parseJSON)}
\DoxyCodeLine{\ \ .then(function(data)\ \{}
\DoxyCodeLine{\ \ \ \ console.log('request\ succeeded\ with\ JSON\ response',\ data)}
\DoxyCodeLine{\ \ \}).catch(function(error)\ \{}
\DoxyCodeLine{\ \ \ \ console.log('request\ failed',\ error)}
\DoxyCodeLine{\ \ \})}

\end{DoxyCode}
\hypertarget{md_node__modules_2whatwg-fetch_2README_autotoc_md29911}{}\doxysubsubsection{\texorpdfstring{Sending cookies}{Sending cookies}}\label{md_node__modules_2whatwg-fetch_2README_autotoc_md29911}
For \href{https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS}{\texttt{ CORS}} requests, use `credentials\+: \textquotesingle{}include'\`{} to allow sending credentials to other domains\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{fetch('https://example.com:1234/users',\ \{}
\DoxyCodeLine{\ \ credentials:\ 'include'}
\DoxyCodeLine{\})}

\end{DoxyCode}


The default value for {\ttfamily credentials} is "{}same-\/origin"{}.

The default for {\ttfamily credentials} wasn\textquotesingle{}t always the same, though. The following versions of browsers implemented an older version of the fetch specification where the default was "{}omit"{}\+:


\begin{DoxyItemize}
\item Firefox 39-\/60
\item Chrome 42-\/67
\item Safari 10.\+1-\/11.\+1.\+2
\end{DoxyItemize}

If you target these browsers, it\textquotesingle{}s advisable to always specify `credentials\+: \textquotesingle{}same-\/origin'\`{} explicitly with all fetch requests instead of relying on the default\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{fetch('/users',\ \{}
\DoxyCodeLine{\ \ credentials:\ 'same-\/origin'}
\DoxyCodeLine{\})}

\end{DoxyCode}


Note\+: due to \href{https://github.com/github/fetch/pull/56\#issuecomment-68835992}{\texttt{ limitations of XMLHttp\+Request}}, using `credentials\+: \textquotesingle{}omit'\`{} is not respected for same domains in browsers where this polyfill is active. Cookies will always be sent to same domains in older browsers.\hypertarget{md_node__modules_2whatwg-fetch_2README_autotoc_md29912}{}\doxysubsubsection{\texorpdfstring{Receiving cookies}{Receiving cookies}}\label{md_node__modules_2whatwg-fetch_2README_autotoc_md29912}
As with XMLHttp\+Request, the {\ttfamily Set-\/\+Cookie} response header returned from the server is a \href{https://developer.mozilla.org/en-US/docs/Glossary/Forbidden_header_name}{\texttt{ forbidden header name}} and therefore can\textquotesingle{}t be programmatically read with {\ttfamily response.\+headers.\+get()}. Instead, it\textquotesingle{}s the browser\textquotesingle{}s responsibility to handle new cookies being set (if applicable to the current URL). Unless they are HTTP-\/only, new cookies will be available through {\ttfamily document.\+cookie}.\hypertarget{md_node__modules_2whatwg-fetch_2README_autotoc_md29913}{}\doxysubsubsection{\texorpdfstring{Redirect modes}{Redirect modes}}\label{md_node__modules_2whatwg-fetch_2README_autotoc_md29913}
The Fetch specification defines these values for \href{https://fetch.spec.whatwg.org/\#concept-request-redirect-mode}{\texttt{ the {\ttfamily redirect} option}}\+: "{}follow"{} (the default), "{}error"{}, and "{}manual"{}.

Due to limitations of XMLHttp\+Request, only the "{}follow"{} mode is available in browsers where this polyfill is active.\hypertarget{md_node__modules_2whatwg-fetch_2README_autotoc_md29914}{}\doxysubsubsection{\texorpdfstring{Obtaining the Response URL}{Obtaining the Response URL}}\label{md_node__modules_2whatwg-fetch_2README_autotoc_md29914}
Due to limitations of XMLHttp\+Request, the {\ttfamily response.\+url} value might not be reliable after HTTP redirects on older browsers.

The solution is to configure the server to set the response HTTP header {\ttfamily X-\/\+Request-\/\+URL} to the current URL after any redirect that might have happened. It should be safe to set it unconditionally.


\begin{DoxyCode}{0}
\DoxyCodeLine{\ ruby}
\DoxyCodeLine{\#\ Ruby\ on\ Rails\ controller\ example}
\DoxyCodeLine{response.headers['X-\/Request-\/URL']\ =\ request.url}

\end{DoxyCode}


This server workaround is necessary if you need reliable {\ttfamily response.\+url} in Firefox \texorpdfstring{$<$}{<} 32, Chrome \texorpdfstring{$<$}{<} 37, Safari, or IE.\hypertarget{md_node__modules_2whatwg-fetch_2README_autotoc_md29915}{}\doxysubsubsection{\texorpdfstring{Aborting requests}{Aborting requests}}\label{md_node__modules_2whatwg-fetch_2README_autotoc_md29915}
This polyfill supports \href{https://developers.google.com/web/updates/2017/09/abortable-fetch}{\texttt{ the abortable fetch API}}. However, aborting a fetch requires use of two additional DOM APIs\+: \href{https://developer.mozilla.org/en-US/docs/Web/API/AbortController}{\texttt{ Abort\+Controller}} and \href{https://developer.mozilla.org/en-US/docs/Web/API/AbortSignal}{\texttt{ Abort\+Signal}}. Typically, browsers that do not support fetch will also not support Abort\+Controller or Abort\+Signal. Consequently, you will need to include \href{https://www.npmjs.com/package/yet-another-abortcontroller-polyfill}{\texttt{ an additional polyfill}} for these APIs to abort fetches\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{import\ 'yet-\/another-\/abortcontroller-\/polyfill'}
\DoxyCodeLine{import\ \{fetch\}\ from\ 'whatwg-\/fetch'}
\DoxyCodeLine{}
\DoxyCodeLine{//\ use\ native\ browser\ implementation\ if\ it\ supports\ aborting}
\DoxyCodeLine{const\ abortableFetch\ =\ ('signal'\ in\ new\ Request(''))\ ?\ window.fetch\ :\ fetch}
\DoxyCodeLine{}
\DoxyCodeLine{const\ controller\ =\ new\ AbortController()}
\DoxyCodeLine{}
\DoxyCodeLine{abortableFetch('/avatars',\ \{}
\DoxyCodeLine{\ \ signal:\ controller.signal}
\DoxyCodeLine{\}).catch(function(ex)\ \{}
\DoxyCodeLine{\ \ if\ (ex.name\ ===\ 'AbortError')\ \{}
\DoxyCodeLine{\ \ \ \ console.log('request\ aborted')}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{\})}
\DoxyCodeLine{}
\DoxyCodeLine{//\ some\ time\ later...}
\DoxyCodeLine{controller.abort()}

\end{DoxyCode}
\hypertarget{md_node__modules_2whatwg-fetch_2README_autotoc_md29916}{}\doxysection{\texorpdfstring{Browser Support}{Browser Support}}\label{md_node__modules_2whatwg-fetch_2README_autotoc_md29916}

\begin{DoxyItemize}
\item Chrome
\item Firefox
\item Safari 6.\+1+
\item Internet Explorer 10+
\end{DoxyItemize}

Note\+: modern browsers such as Chrome, Firefox, Microsoft Edge, and Safari contain native implementations of {\ttfamily window.\+fetch}, therefore the code from this polyfill doesn\textquotesingle{}t have any effect on those browsers. If you believe you\textquotesingle{}ve encountered an error with how {\ttfamily window.\+fetch} is implemented in any of these browsers, you should file an issue with that browser vendor instead of this project. 