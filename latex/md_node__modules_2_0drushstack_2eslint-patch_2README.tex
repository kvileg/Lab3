\chapter{@rushstack/eslint-\/patch}
\hypertarget{md_node__modules_2_0drushstack_2eslint-patch_2README}{}\label{md_node__modules_2_0drushstack_2eslint-patch_2README}\index{"@rushstack/eslint-\/patch@{"@rushstack/eslint-\/patch}}
\label{md_node__modules_2_0drushstack_2eslint-patch_2README_autotoc_md2387}%
\Hypertarget{md_node__modules_2_0drushstack_2eslint-patch_2README_autotoc_md2387}%
 Enhance \href{https://eslint.org/}{\texttt{ ESLint}} with better support for large scale monorepos!

This is a runtime patch that enables new/experimental features for ESLint. It operates as a "{}monkey patch"{} that gets loaded with \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}.eslintrc.\+js\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*} and modifies the ESLint engine in memory. This approach works with your existing ESLint version (no need to install a forked ESLint), and is fully interoperable with companion tools such as the ESLint extensions for VS Code and Web\+Storm.

This package provides several independently loadable features\+:


\begin{DoxyItemize}
\item {\bfseries{eslint-\/bulk-\/suppressions}}\+: enables you to roll out new lint rules in your monorepo without having to clutter up source files with thousands of machine-\/generated {\ttfamily // eslint-\/ignore-\/next-\/line} directives. Instead, the "{}bulk suppressions"{} for legacy violations are managed in a separate file called \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}.eslint-\/bulk-\/suppressions.\+json\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}.
\item {\bfseries{modern-\/module-\/resolution}}\+: allows an ESLint config package to provide plugin dependencies, avoiding the problem where hundreds of projects in a monorepo need to copy+paste the same {\ttfamily "{}dev\+Dependencies"{}} in every {\bfseries{package.\+json}} file.
\end{DoxyItemize}

\begin{quote}
{\bfseries{NOTE\+:}} ESLint 8.\+21.\+0 has now introduced a new {\ttfamily ESLINT\+\_\+\+USE\+\_\+\+FLAT\+\_\+\+CONFIG} mode that may reduce the need for the {\ttfamily modern-\/module-\/resolution} patch. \end{quote}

\begin{DoxyItemize}
\item {\bfseries{custom-\/config-\/package-\/names}}\+: enables \href{https://heft.rushstack.io/pages/intro/rig_packages/}{\texttt{ rig packages}} to provide shareable configs for ESLint, by removing the requirement that {\ttfamily eslint-\/config} must appear in the NPM package name.
\end{DoxyItemize}

Contributions welcome! If you have more ideas for experimental ESLint enhancements that might benefit large scale monorepos, consider adding them to this patch.\hypertarget{md_node__modules_2_0drushstack_2eslint-patch_2README_autotoc_md2388}{}\doxysection{\texorpdfstring{eslint-\/bulk-\/suppressions feature}{eslint-bulk-suppressions feature}}\label{md_node__modules_2_0drushstack_2eslint-patch_2README_autotoc_md2388}
\hypertarget{md_node__modules_2_0drushstack_2eslint-patch_2README_autotoc_md2389}{}\doxysubsubsection{\texorpdfstring{What it does}{What it does}}\label{md_node__modules_2_0drushstack_2eslint-patch_2README_autotoc_md2389}
As your monorepo evolves and grows, there\textquotesingle{}s an ongoing need to expand and improve lint rules. But whenever a new rule is enabled, there may be hundreds or thousands of "{}legacy violations"{} in existing source files. How to handle that? We could fix the old code, but that\textquotesingle{}s often prohibitively expensive and may even cause regressions. We could disable the rule for those projects or files, but we want new code to follow the rule. An effective solution is to inject thousands of {\ttfamily // eslint-\/ignore-\/next-\/line} lines, but these "{}bulk suppressions"{} have an unintended side effect\+: It normalizes the practice of suppressing lint rules. If people get used to seeing {\ttfamily // eslint-\/ignore-\/next-\/line} everywhere, nobody will notice when humans suppress the rules for new code. That would undermine the mission of establishing better code standards.

The {\ttfamily eslint-\/bulk-\/suppressions} feature introduces a way to store machine-\/generated suppressions in a separate file \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}.eslint-\/bulk-\/suppressions.\+json\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*} which can even be protected using {\ttfamily CODEOWNERS} policies, since that file will generally only change when new lint rules are introduced, or in occasional circumstances when existing files are being moved or renamed. In this way {\ttfamily // eslint-\/ignore-\/next-\/line} remains a directive written by humans and hopefully rarely needed.\hypertarget{md_node__modules_2_0drushstack_2eslint-patch_2README_autotoc_md2390}{}\doxysubsubsection{\texorpdfstring{Why it\textquotesingle{}s a patch}{Why it's a patch}}\label{md_node__modules_2_0drushstack_2eslint-patch_2README_autotoc_md2390}
As with {\ttfamily modern-\/module-\/resolution}, our hope is for this feature to eventually be incorporated as an official feature of ESLint. Starting out as an unofficial patch allows faster iteration and community feedback.\hypertarget{md_node__modules_2_0drushstack_2eslint-patch_2README_autotoc_md2391}{}\doxysubsubsection{\texorpdfstring{How to use it}{How to use it}}\label{md_node__modules_2_0drushstack_2eslint-patch_2README_autotoc_md2391}

\begin{DoxyEnumerate}
\item Add {\ttfamily @rushstack/eslint-\/patch} as a dependency of your project\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{cd\ your-\/project}
\DoxyCodeLine{npm\ install\ -\/-\/save-\/dev\ @rushstack/eslint-\/patch}

\end{DoxyCode}

\item Globally install the \href{https://www.npmjs.com/package/@rushstack/eslint-bulk}{\texttt{ {\ttfamily @rushstack/eslint-\/bulk}}} command line interface (CLI) package. For example\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{npm\ install\ -\/-\/global\ @rushstack/eslint-\/bulk}

\end{DoxyCode}


This installs the {\ttfamily eslint-\/bulk} shell command for managing the \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}.eslint-\/bulk-\/suppressions.\+json\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*} files. With it you can generate new suppressions as well as "{}prune"{} old suppressions that are no longer needed.
\item Load the patch by adding the following {\ttfamily require()} statement as the first line of your \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}.eslintrc.\+js\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*} file. For example\+:

\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}.eslintrc.\+js\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*} 
\begin{DoxyCode}{0}
\DoxyCodeLine{require("{}@rushstack/eslint-\/patch/eslint-\/bulk-\/suppressions"{});\ //\ ðŸ‘ˆ\ add\ this\ line}
\DoxyCodeLine{}
\DoxyCodeLine{module.exports\ =\ \{}
\DoxyCodeLine{\ \ rules:\ \{}
\DoxyCodeLine{\ \ \ \ rule1:\ 'error',}
\DoxyCodeLine{\ \ \ \ rule2:\ 'warning'}
\DoxyCodeLine{\ \ \},}
\DoxyCodeLine{\ \ parserOptions:\ \{\ tsconfigRootDir:\ \_\_dirname\ \}}
\DoxyCodeLine{\};}

\end{DoxyCode}

\end{DoxyEnumerate}

Typical workflow\+:


\begin{DoxyEnumerate}
\item Checkout your {\ttfamily main} branch, which is in a clean state where ESLint reports no violations.
\item Update your configuration to enable the latest lint rules; ESLint now reports thousands of legacy violations.
\item Run {\ttfamily eslint-\/bulk suppress -\/-\/all ./src} to update \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}.eslint-\/bulk-\/suppressions.\+json.\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}
\item ESLint now no longer reports violations, so commit the results to Git and merge your pull request.
\item Over time, engineers may improve some of the suppressed code, in which case the associated suppressions are no longer needed.
\item Run {\ttfamily eslint-\/bulk prune} periodically to find and remove unnecessary suppressions from \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}.eslint-\/bulk-\/suppressions.\+json\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}, ensuring that new violations will now get caught in those scopes.
\end{DoxyEnumerate}\hypertarget{md_node__modules_2_0drushstack_2eslint-patch_2README_autotoc_md2392}{}\doxysubsubsection{\texorpdfstring{"{}eslint-\/bulk suppress"{} command}{"eslint-bulk suppress" command}}\label{md_node__modules_2_0drushstack_2eslint-patch_2README_autotoc_md2392}

\begin{DoxyCode}{0}
\DoxyCodeLine{eslint-\/bulk\ suppress\ -\/-\/rule\ NAME1\ [-\/-\/rule\ NAME2...]\ PATH1\ [PATH2...]}
\DoxyCodeLine{eslint-\/bulk\ suppress\ -\/-\/all\ PATH1\ [PATH2...]}

\end{DoxyCode}


Use this command to automatically generate bulk suppressions for the specified lint rules and file paths. The path argument is a \href{https://en.wikipedia.org/wiki/Glob_(programming)}{\texttt{ glob pattern}} with the same syntax as path arguments for the {\ttfamily eslint} command.\hypertarget{md_node__modules_2_0drushstack_2eslint-patch_2README_autotoc_md2393}{}\doxysubsubsection{\texorpdfstring{"{}eslint-\/bulk prune"{} command}{"eslint-bulk prune" command}}\label{md_node__modules_2_0drushstack_2eslint-patch_2README_autotoc_md2393}
Use this command to automatically delete all unnecessary suppression entries in all \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}.eslint-\/bulk-\/suppressions.\+json\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*} files under the current working directory.


\begin{DoxyCode}{0}
\DoxyCodeLine{eslint-\/bulk\ prune}

\end{DoxyCode}
\hypertarget{md_node__modules_2_0drushstack_2eslint-patch_2README_autotoc_md2394}{}\doxysubsubsection{\texorpdfstring{Implementation notes}{Implementation notes}}\label{md_node__modules_2_0drushstack_2eslint-patch_2README_autotoc_md2394}
The {\ttfamily eslint-\/bulk} command is a thin wrapper whose behavior is actually provided by the patch itself. In this way, if your monorepo contains projects using different versions of this package, the same globally installed {\ttfamily eslint-\/bulk} command can be used under any project folder, and it will always invoke the correct version of the engine compatible with that project. Because the patch is loaded by ESLint, the {\ttfamily eslint-\/bulk} command must be invoked in a project folder that contains an \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}.eslintrc.\+js\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*} configuration with correctly installed {\bfseries{package.\+json}} dependencies.

Here\textquotesingle{}s an example of the bulk suppressions file content\+:

\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}.eslint-\/bulk-\/suppressions.\+json\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*} 
\begin{DoxyCode}{0}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ "{}suppressions"{}:\ [}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ "{}rule"{}:\ "{}no-\/var"{},}
\DoxyCodeLine{\ \ \ \ \ \ "{}file"{}:\ "{}./src/your-\/file.ts"{},}
\DoxyCodeLine{\ \ \ \ \ \ "{}scopeId"{}:\ "{}.ExampleClass.exampleMethod"{}}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ ]}
\DoxyCodeLine{\}}

\end{DoxyCode}
 The {\ttfamily rule} field is the ESLint rule name. The {\ttfamily file} field is the source file path, relative to the {\bfseries{eslintrc.\+js}} file. The {\ttfamily scope\+Id} is a special string built from the names of containing structures. (For implementation details, take a look at the \href{https://github.com/microsoft/rushstack/blob/e95c51088341f01516ee5a7639d57c3f6dce8772/eslint/eslint-patch/src/eslint-bulk-suppressions/bulk-suppressions-patch.ts\#L52}{\texttt{ calculate\+Scope\+Id()}} function.) The {\ttfamily scope\+Id} identifies a region of code where the rule should be suppressed, while being reasonably stable across edits of the source file.\hypertarget{md_node__modules_2_0drushstack_2eslint-patch_2README_autotoc_md2395}{}\doxysection{\texorpdfstring{modern-\/module-\/resolution feature}{modern-module-resolution feature}}\label{md_node__modules_2_0drushstack_2eslint-patch_2README_autotoc_md2395}
\hypertarget{md_node__modules_2_0drushstack_2eslint-patch_2README_autotoc_md2396}{}\doxysubsubsection{\texorpdfstring{What it does}{What it does}}\label{md_node__modules_2_0drushstack_2eslint-patch_2README_autotoc_md2396}
This patch is a workaround for a longstanding \href{https://github.com/eslint/eslint/issues/3458}{\texttt{ ESLint feature request}} that would allow a shareable ESLint config to bring along its own plugins, rather than imposing peer dependencies on every consumer of the config. In a monorepo scenario, this enables your lint setup to be consolidated in a single NPM package. Doing so greatly reduces the copy+pasting and version management for all the other projects that use your standard lint rule set, but don\textquotesingle{}t want to be bothered with the details.

\begin{quote}
{\bfseries{NOTE\+:}} ESLint 8.\+21.\+0 has now introduced a new {\ttfamily ESLINT\+\_\+\+USE\+\_\+\+FLAT\+\_\+\+CONFIG} mode that may reduce the need for this patch. \end{quote}
\hypertarget{md_node__modules_2_0drushstack_2eslint-patch_2README_autotoc_md2397}{}\doxysubsubsection{\texorpdfstring{Why it\textquotesingle{}s a patch}{Why it's a patch}}\label{md_node__modules_2_0drushstack_2eslint-patch_2README_autotoc_md2397}
We initially proposed this feature in a pull request for the official ESLint back in 2019, however the maintainers preferred to implement a more comprehensive overhaul of the ESLint config engine. It ultimately shipped with the experimental new {\ttfamily ESLINT\+\_\+\+USE\+\_\+\+FLAT\+\_\+\+CONFIG} mode (still opt-\/in as of ESLint 8). While waiting for that, Rush Stack\textquotesingle{}s {\ttfamily modern-\/module-\/resolution} patch provided a reliable interim solution. We will continue to maintain this patch as long as it is being widely used, but we encourage you to check out {\ttfamily ESLINT\+\_\+\+USE\+\_\+\+FLAT\+\_\+\+CONFIG} and see if it meets your needs.\hypertarget{md_node__modules_2_0drushstack_2eslint-patch_2README_autotoc_md2398}{}\doxysubsubsection{\texorpdfstring{How to use it}{How to use it}}\label{md_node__modules_2_0drushstack_2eslint-patch_2README_autotoc_md2398}

\begin{DoxyEnumerate}
\item Add {\ttfamily @rushstack/eslint-\/patch} as a dependency of your project\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{cd\ your-\/project}
\DoxyCodeLine{npm\ install\ -\/-\/save-\/dev\ @rushstack/eslint-\/patch}

\end{DoxyCode}

\item Add a {\ttfamily require()} call to the to top of the \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}.eslintrc.\+js\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*} file for each project that depends on your shareable ESLint config, for example\+:

\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}.eslintrc.\+js\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*} 
\begin{DoxyCode}{0}
\DoxyCodeLine{require("{}@rushstack/eslint-\/patch/modern-\/module-\/resolution"{});\ //\ ðŸ‘ˆ\ add\ this\ line}
\DoxyCodeLine{}
\DoxyCodeLine{//\ Add\ your\ "{}extends"{}\ boilerplate\ here,\ for\ example:}
\DoxyCodeLine{module.exports\ =\ \{}
\DoxyCodeLine{\ \ extends:\ ['@your-\/company/eslint-\/config'],}
\DoxyCodeLine{\ \ parserOptions:\ \{\ tsconfigRootDir:\ \_\_dirname\ \}}
\DoxyCodeLine{\};}

\end{DoxyCode}

\end{DoxyEnumerate}

With this change, the local project no longer needs any ESLint plugins in its {\bfseries{package.\+json}} file. Instead, the hypothetical {\ttfamily @your-\/company/eslint-\/config} NPM package would declare the plugins as its own dependencies.

This patch works by modifying the ESLint engine so that its module resolver will load relative to the folder of the referencing config file, rather than the project folder. The patch is compatible with ESLint 6, 7, and 8. It also works with any editor extensions that load ESLint as a library.

For an even leaner setup, {\ttfamily @your-\/company/eslint-\/config} can provide the patches as its own dependency. See \href{https://github.com/microsoft/rushstack/blob/main/eslint/eslint-config/patch/modern-module-resolution.js}{\texttt{ @rushstack/eslint-\/config}} for a real world example.\hypertarget{md_node__modules_2_0drushstack_2eslint-patch_2README_autotoc_md2399}{}\doxysection{\texorpdfstring{custom-\/config-\/package-\/names feature}{custom-config-package-names feature}}\label{md_node__modules_2_0drushstack_2eslint-patch_2README_autotoc_md2399}
\hypertarget{md_node__modules_2_0drushstack_2eslint-patch_2README_autotoc_md2400}{}\doxysubsubsection{\texorpdfstring{What it does}{What it does}}\label{md_node__modules_2_0drushstack_2eslint-patch_2README_autotoc_md2400}
Load the {\ttfamily custom-\/config-\/package-\/names} patch to remove ESLint\textquotesingle{}s \href{https://eslint.org/docs/latest/extend/shareable-configs}{\texttt{ naming requirement}} that {\ttfamily eslint-\/config} must be part of the NPM package name for shareable configs.

This is useful because Rush Stack\textquotesingle{}s \href{https://heft.rushstack.io/pages/intro/rig_packages/}{\texttt{ rig package}} specification defines a way for many different tooling configurations and dependencies to be shared via a single NPM package, for example \href{https://www.npmjs.com/package/@rushstack/heft-web-rig}{\texttt{ {\ttfamily @rushstack/heft-\/web-\/rig}}}. Rigs avoid a lot of copy+pasting of dependencies in a large scale monorepo. Rig packages always include the {\ttfamily -\/rig} suffix in their name. It doesn\textquotesingle{}t make sense to enforce that {\ttfamily eslint-\/config} should also appear in the name of a package that includes shareable configs for many other tools besides ESLint.\hypertarget{md_node__modules_2_0drushstack_2eslint-patch_2README_autotoc_md2401}{}\doxysubsubsection{\texorpdfstring{How to use it}{How to use it}}\label{md_node__modules_2_0drushstack_2eslint-patch_2README_autotoc_md2401}
Continuing the example above, to load this patch you would add a second line to your config file\+:

\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}.eslintrc.\+js\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*} 
\begin{DoxyCode}{0}
\DoxyCodeLine{require("{}@rushstack/eslint-\/patch/modern-\/module-\/resolution"{});}
\DoxyCodeLine{require("{}@rushstack/eslint-\/patch/custom-\/config-\/package-\/names"{});\ //\ ðŸ‘ˆ\ add\ this\ line}
\DoxyCodeLine{}
\DoxyCodeLine{//\ Add\ your\ "{}extends"{}\ boilerplate\ here,\ for\ example:}
\DoxyCodeLine{module.exports\ =\ \{}
\DoxyCodeLine{\ \ extends:\ [}
\DoxyCodeLine{\ \ \ \ '@your-\/company/build-\/rig/profile/default/includes/eslint/node'\ //\ Notice\ the\ package\ name\ does\ not\ start\ with\ "{}eslint-\/config-\/"{}}
\DoxyCodeLine{\ \ ],}
\DoxyCodeLine{\ \ parserOptions:\ \{\ tsconfigRootDir:\ \_\_dirname\ \}}
\DoxyCodeLine{\};}

\end{DoxyCode}
\hypertarget{md_node__modules_2_0drushstack_2eslint-patch_2README_autotoc_md2402}{}\doxysection{\texorpdfstring{Links}{Links}}\label{md_node__modules_2_0drushstack_2eslint-patch_2README_autotoc_md2402}

\begin{DoxyItemize}
\item \href{https://github.com/microsoft/rushstack/blob/main/eslint/eslint-patch/CHANGELOG.md}{\texttt{ CHANGELOG.\+md}} -\/ Find out what\textquotesingle{}s new in the latest version
\item \href{https://www.npmjs.com/package/@rushstack/eslint-bulk}{\texttt{ {\ttfamily @rushstack/eslint-\/bulk}}} CLI package
\end{DoxyItemize}

{\ttfamily @rushstack/eslint-\/patch} is part of the \href{https://rushstack.io/}{\texttt{ Rush Stack}} family of projects. 