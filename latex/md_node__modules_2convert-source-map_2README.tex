\chapter{convert-\/source-\/map \texorpdfstring{$<$}{<}a href="{}https\+://github.\+com/thlorenz/convert-\/source-\/map/actions?query=workflow\+:ci"{} \texorpdfstring{$>$}{>}\texorpdfstring{$<$}{<}img src="{}https\+://img.\+shields.\+io/github/workflow/status/thlorenz/convert-\/source-\/map/\+CI?style=flat-\/square"{} alt="{}\+Build Status"{}/\texorpdfstring{$>$}{>}\texorpdfstring{$<$}{<}/a\texorpdfstring{$>$}{>}}
\hypertarget{md_node__modules_2convert-source-map_2README}{}\label{md_node__modules_2convert-source-map_2README}\index{convert-\/source-\/map $<$a href="{}https://github.com/thlorenz/convert-\/source-\/map/actions?query=workflow:ci"{} $>$$<$img src="{}https://img.shields.io/github/workflow/status/thlorenz/convert-\/source-\/map/CI?style=flat-\/square"{} alt="{}Build Status"{}/$>$$<$/a$>$@{convert-\/source-\/map $<$a href=""https://github.com/thlorenz/convert-\/source-\/map/actions?query=workflow:ci"" $>$$<$img src=""https://img.shields.io/github/workflow/status/thlorenz/convert-\/source-\/map/CI?style=flat-\/square"" alt=""Build Status""/$>$$<$/a$>$}}
\label{md_node__modules_2convert-source-map_2README_autotoc_md8199}%
\Hypertarget{md_node__modules_2convert-source-map_2README_autotoc_md8199}%
 Converts a source-\/map from/to different formats and allows adding/changing properties.


\begin{DoxyCode}{0}
\DoxyCodeLine{var\ convert\ =\ require('convert-\/source-\/map');}
\DoxyCodeLine{}
\DoxyCodeLine{var\ json\ =\ convert}
\DoxyCodeLine{\ \ .fromComment('//\#\ sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVpbGQvZm9vLm1pbi5qcyIsInNvdXJjZXMiOlsic3JjL2Zvby5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSIsInNvdXJjZVJvb3QiOiIvIn0=')}
\DoxyCodeLine{\ \ .toJSON();}
\DoxyCodeLine{}
\DoxyCodeLine{var\ modified\ =\ convert}
\DoxyCodeLine{\ \ .fromComment('//\#\ sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVpbGQvZm9vLm1pbi5qcyIsInNvdXJjZXMiOlsic3JjL2Zvby5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSIsInNvdXJjZVJvb3QiOiIvIn0=')}
\DoxyCodeLine{\ \ .setProperty('sources',\ [\ 'SRC/FOO.JS'\ ])}
\DoxyCodeLine{\ \ .toJSON();}
\DoxyCodeLine{}
\DoxyCodeLine{console.log(json);}
\DoxyCodeLine{console.log(modified);}

\end{DoxyCode}



\begin{DoxyCode}{0}
\DoxyCodeLine{\{"{}version"{}:3,"{}file"{}:"{}build/foo.min.js"{},"{}sources"{}:["{}src/foo.js"{}],"{}names"{}:[],"{}mappings"{}:"{}AAAA"{},"{}sourceRoot"{}:"{}/"{}\}}
\DoxyCodeLine{\{"{}version"{}:3,"{}file"{}:"{}build/foo.min.js"{},"{}sources"{}:["{}SRC/FOO.JS"{}],"{}names"{}:[],"{}mappings"{}:"{}AAAA"{},"{}sourceRoot"{}:"{}/"{}\}}

\end{DoxyCode}
\hypertarget{md_node__modules_2convert-source-map_2README_autotoc_md8200}{}\doxysection{\texorpdfstring{Upgrading}{Upgrading}}\label{md_node__modules_2convert-source-map_2README_autotoc_md8200}
Prior to v2.\+0.\+0, the {\ttfamily from\+Map\+File\+Comment} and {\ttfamily from\+Map\+File\+Source} functions took a String directory path and used that to resolve \& read the source map file from the filesystem. However, this made the library limited to nodejs environments and broke on sources with querystrings.

In v2.\+0.\+0, you now need to pass a function that does the file reading. It will receive the source filename as a String that you can resolve to a filesystem path, URL, or anything else.

If you are using {\ttfamily convert-\/source-\/map} in nodejs and want the previous behavior, you\textquotesingle{}ll use a function like such\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{+\ var\ fs\ =\ require('fs');\ //\ Import\ the\ fs\ module\ to\ read\ a\ file}
\DoxyCodeLine{+\ var\ path\ =\ require('path');\ //\ Import\ the\ path\ module\ to\ resolve\ a\ path\ against\ your\ directory}
\DoxyCodeLine{-\/\ var\ conv\ =\ convert.fromMapFileSource(css,\ '../my-\/dir');}
\DoxyCodeLine{+\ var\ conv\ =\ convert.fromMapFileSource(css,\ function\ (filename)\ \{}
\DoxyCodeLine{+\ \ \ return\ fs.readFileSync(path.resolve('../my-\/dir',\ filename),\ 'utf-\/8');}
\DoxyCodeLine{+\ \});}

\end{DoxyCode}
\hypertarget{md_node__modules_2convert-source-map_2README_autotoc_md8201}{}\doxysection{\texorpdfstring{API}{API}}\label{md_node__modules_2convert-source-map_2README_autotoc_md8201}
\hypertarget{md_node__modules_2convert-source-map_2README_autotoc_md8202}{}\doxysubsection{\texorpdfstring{from\+Object(obj)}{fromObject(obj)}}\label{md_node__modules_2convert-source-map_2README_autotoc_md8202}
Returns source map converter from given object.\hypertarget{md_node__modules_2convert-source-map_2README_autotoc_md8203}{}\doxysubsection{\texorpdfstring{from\+JSON(json)}{fromJSON(json)}}\label{md_node__modules_2convert-source-map_2README_autotoc_md8203}
Returns source map converter from given json string.\hypertarget{md_node__modules_2convert-source-map_2README_autotoc_md8204}{}\doxysubsection{\texorpdfstring{from\+URI(uri)}{fromURI(uri)}}\label{md_node__modules_2convert-source-map_2README_autotoc_md8204}
Returns source map converter from given uri encoded json string.\hypertarget{md_node__modules_2convert-source-map_2README_autotoc_md8205}{}\doxysubsection{\texorpdfstring{from\+Base64(base64)}{fromBase64(base64)}}\label{md_node__modules_2convert-source-map_2README_autotoc_md8205}
Returns source map converter from given base64 encoded json string.\hypertarget{md_node__modules_2convert-source-map_2README_autotoc_md8206}{}\doxysubsection{\texorpdfstring{from\+Comment(comment)}{fromComment(comment)}}\label{md_node__modules_2convert-source-map_2README_autotoc_md8206}
Returns source map converter from given base64 or uri encoded json string prefixed with {\ttfamily //\# source\+Mapping\+URL=...}.\hypertarget{md_node__modules_2convert-source-map_2README_autotoc_md8207}{}\doxysubsection{\texorpdfstring{from\+Map\+File\+Comment(comment, read\+Map)}{fromMapFileComment(comment, readMap)}}\label{md_node__modules_2convert-source-map_2README_autotoc_md8207}
Returns source map converter from given {\ttfamily filename} by parsing {\ttfamily //\# source\+Mapping\+URL=filename}.

{\ttfamily read\+Map} must be a function which receives the source map filename and returns either a String or Buffer of the source map (if read synchronously), or a {\ttfamily Promise} containing a String or Buffer of the source map (if read asynchronously).

If {\ttfamily read\+Map} doesn\textquotesingle{}t return a {\ttfamily Promise}, {\ttfamily from\+Map\+File\+Comment} will return a source map converter synchronously.

If {\ttfamily read\+Map} returns a {\ttfamily Promise}, {\ttfamily from\+Map\+File\+Comment} will also return {\ttfamily Promise}. The {\ttfamily Promise} will be either resolved with the source map converter or rejected with an error.\hypertarget{md_node__modules_2convert-source-map_2README_autotoc_md8208}{}\doxysubsubsection{\texorpdfstring{Examples}{Examples}}\label{md_node__modules_2convert-source-map_2README_autotoc_md8208}
{\bfseries{Synchronous read in Node.\+js\+:}}


\begin{DoxyCode}{0}
\DoxyCodeLine{var\ convert\ =\ require('convert-\/source-\/map');}
\DoxyCodeLine{var\ fs\ =\ require('fs');}
\DoxyCodeLine{}
\DoxyCodeLine{function\ readMap(filename)\ \{}
\DoxyCodeLine{\ \ return\ fs.readFileSync(filename,\ 'utf8');}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{var\ json\ =\ convert}
\DoxyCodeLine{\ \ .fromMapFileComment('//\#\ sourceMappingURL=map-\/file-\/comment.css.map',\ readMap)}
\DoxyCodeLine{\ \ .toJSON();}
\DoxyCodeLine{console.log(json);}

\end{DoxyCode}


{\bfseries{Asynchronous read in Node.\+js\+:}}


\begin{DoxyCode}{0}
\DoxyCodeLine{var\ convert\ =\ require('convert-\/source-\/map');}
\DoxyCodeLine{var\ \{\ promises:\ fs\ \}\ =\ require('fs');\ //\ Notice\ the\ \`{}promises`\ import}
\DoxyCodeLine{}
\DoxyCodeLine{function\ readMap(filename)\ \{}
\DoxyCodeLine{\ \ return\ fs.readFile(filename,\ 'utf8');}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{var\ converter\ =\ await\ convert.fromMapFileComment('//\#\ sourceMappingURL=map-\/file-\/comment.css.map',\ readMap)}
\DoxyCodeLine{var\ json\ =\ converter.toJSON();}
\DoxyCodeLine{console.log(json);}

\end{DoxyCode}


{\bfseries{Asynchronous read in the browser\+:}}


\begin{DoxyCode}{0}
\DoxyCodeLine{var\ convert\ =\ require('convert-\/source-\/map');}
\DoxyCodeLine{}
\DoxyCodeLine{async\ function\ readMap(url)\ \{}
\DoxyCodeLine{\ \ const\ res\ =\ await\ fetch(url);}
\DoxyCodeLine{\ \ return\ res.text();}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{const\ converter\ =\ await\ convert.fromMapFileComment('//\#\ sourceMappingURL=map-\/file-\/comment.css.map',\ readMap)}
\DoxyCodeLine{var\ json\ =\ converter.toJSON();}
\DoxyCodeLine{console.log(json);}

\end{DoxyCode}
\hypertarget{md_node__modules_2convert-source-map_2README_autotoc_md8209}{}\doxysubsection{\texorpdfstring{from\+Source(source)}{fromSource(source)}}\label{md_node__modules_2convert-source-map_2README_autotoc_md8209}
Finds last sourcemap comment in file and returns source map converter or returns {\ttfamily null} if no source map comment was found.\hypertarget{md_node__modules_2convert-source-map_2README_autotoc_md8210}{}\doxysubsection{\texorpdfstring{from\+Map\+File\+Source(source, read\+Map)}{fromMapFileSource(source, readMap)}}\label{md_node__modules_2convert-source-map_2README_autotoc_md8210}
Finds last sourcemap comment in file and returns source map converter or returns {\ttfamily null} if no source map comment was found.

{\ttfamily read\+Map} must be a function which receives the source map filename and returns either a String or Buffer of the source map (if read synchronously), or a {\ttfamily Promise} containing a String or Buffer of the source map (if read asynchronously).

If {\ttfamily read\+Map} doesn\textquotesingle{}t return a {\ttfamily Promise}, {\ttfamily from\+Map\+File\+Source} will return a source map converter synchronously.

If {\ttfamily read\+Map} returns a {\ttfamily Promise}, {\ttfamily from\+Map\+File\+Source} will also return {\ttfamily Promise}. The {\ttfamily Promise} will be either resolved with the source map converter or rejected with an error.\hypertarget{md_node__modules_2convert-source-map_2README_autotoc_md8211}{}\doxysubsection{\texorpdfstring{to\+Object()}{toObject()}}\label{md_node__modules_2convert-source-map_2README_autotoc_md8211}
Returns a copy of the underlying source map.\hypertarget{md_node__modules_2convert-source-map_2README_autotoc_md8212}{}\doxysubsection{\texorpdfstring{to\+JSON(\mbox{[}space\mbox{]})}{toJSON([space])}}\label{md_node__modules_2convert-source-map_2README_autotoc_md8212}
Converts source map to json string. If {\ttfamily space} is given (optional), this will be passed to \href{https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/JSON/stringify}{\texttt{ JSON.\+stringify}} when the JSON string is generated.\hypertarget{md_node__modules_2convert-source-map_2README_autotoc_md8213}{}\doxysubsection{\texorpdfstring{to\+URI()}{toURI()}}\label{md_node__modules_2convert-source-map_2README_autotoc_md8213}
Converts source map to uri encoded json string.\hypertarget{md_node__modules_2convert-source-map_2README_autotoc_md8214}{}\doxysubsection{\texorpdfstring{to\+Base64()}{toBase64()}}\label{md_node__modules_2convert-source-map_2README_autotoc_md8214}
Converts source map to base64 encoded json string.\hypertarget{md_node__modules_2convert-source-map_2README_autotoc_md8215}{}\doxysubsection{\texorpdfstring{to\+Comment(\mbox{[}options\mbox{]})}{toComment([options])}}\label{md_node__modules_2convert-source-map_2README_autotoc_md8215}
Converts source map to an inline comment that can be appended to the source-\/file.

By default, the comment is formatted like\+: {\ttfamily //\# source\+Mapping\+URL=...}, which you would normally see in a JS source file.

When `options.\+encoding == \textquotesingle{}uri'\`{}, the data will be uri encoded, otherwise they will be base64 encoded.

When {\ttfamily options.\+multiline == true}, the comment is formatted like\+: {\ttfamily /\texorpdfstring{$\ast$}{*}\# source\+Mapping\+URL=... \texorpdfstring{$\ast$}{*}/}, which you would find in a CSS source file.\hypertarget{md_node__modules_2convert-source-map_2README_autotoc_md8216}{}\doxysubsection{\texorpdfstring{add\+Property(key, value)}{addProperty(key, value)}}\label{md_node__modules_2convert-source-map_2README_autotoc_md8216}
Adds given property to the source map. Throws an error if property already exists.\hypertarget{md_node__modules_2convert-source-map_2README_autotoc_md8217}{}\doxysubsection{\texorpdfstring{set\+Property(key, value)}{setProperty(key, value)}}\label{md_node__modules_2convert-source-map_2README_autotoc_md8217}
Sets given property to the source map. If property doesn\textquotesingle{}t exist it is added, otherwise its value is updated.\hypertarget{md_node__modules_2convert-source-map_2README_autotoc_md8218}{}\doxysubsection{\texorpdfstring{get\+Property(key)}{getProperty(key)}}\label{md_node__modules_2convert-source-map_2README_autotoc_md8218}
Gets given property of the source map.\hypertarget{md_node__modules_2convert-source-map_2README_autotoc_md8219}{}\doxysubsection{\texorpdfstring{remove\+Comments(src)}{removeComments(src)}}\label{md_node__modules_2convert-source-map_2README_autotoc_md8219}
Returns {\ttfamily src} with all source map comments removed\hypertarget{md_node__modules_2convert-source-map_2README_autotoc_md8220}{}\doxysubsection{\texorpdfstring{remove\+Map\+File\+Comments(src)}{removeMapFileComments(src)}}\label{md_node__modules_2convert-source-map_2README_autotoc_md8220}
Returns {\ttfamily src} with all source map comments pointing to map files removed.\hypertarget{md_node__modules_2convert-source-map_2README_autotoc_md8221}{}\doxysubsection{\texorpdfstring{comment\+Regex}{commentRegex}}\label{md_node__modules_2convert-source-map_2README_autotoc_md8221}
Provides {\bfseries{a fresh}} Reg\+Exp each time it is accessed. Can be used to find source map comments.

Breaks down a source map comment into groups\+: Groups\+: 1\+: media type, 2\+: MIME type, 3\+: charset, 4\+: encoding, 5\+: data.\hypertarget{md_node__modules_2convert-source-map_2README_autotoc_md8222}{}\doxysubsection{\texorpdfstring{map\+File\+Comment\+Regex}{mapFileCommentRegex}}\label{md_node__modules_2convert-source-map_2README_autotoc_md8222}
Provides {\bfseries{a fresh}} Reg\+Exp each time it is accessed. Can be used to find source map comments pointing to map files.\hypertarget{md_node__modules_2convert-source-map_2README_autotoc_md8223}{}\doxysubsection{\texorpdfstring{generate\+Map\+File\+Comment(file, \mbox{[}options\mbox{]})}{generateMapFileComment(file, [options])}}\label{md_node__modules_2convert-source-map_2README_autotoc_md8223}
Returns a comment that links to an external source map via {\ttfamily file}.

By default, the comment is formatted like\+: {\ttfamily //\# source\+Mapping\+URL=...}, which you would normally see in a JS source file.

When {\ttfamily options.\+multiline == true}, the comment is formatted like\+: {\ttfamily /\texorpdfstring{$\ast$}{*}\# source\+Mapping\+URL=... \texorpdfstring{$\ast$}{*}/}, which you would find in a CSS source file. 