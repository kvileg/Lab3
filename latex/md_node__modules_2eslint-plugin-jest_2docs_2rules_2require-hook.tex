\chapter{Require setup and teardown code to be within a hook (\texorpdfstring{$<$}{<}tt\texorpdfstring{$>$}{>}require-\/hook\texorpdfstring{$<$}{<}/tt\texorpdfstring{$>$}{>})}
\hypertarget{md_node__modules_2eslint-plugin-jest_2docs_2rules_2require-hook}{}\label{md_node__modules_2eslint-plugin-jest_2docs_2rules_2require-hook}\index{Require setup and teardown code to be within a hook ($<$tt$>$require-\/hook$<$/tt$>$)@{Require setup and teardown code to be within a hook ($<$tt$>$require-\/hook$<$/tt$>$)}}
\label{md_node__modules_2eslint-plugin-jest_2docs_2rules_2require-hook_autotoc_md11475}%
\Hypertarget{md_node__modules_2eslint-plugin-jest_2docs_2rules_2require-hook_autotoc_md11475}%
 Often while writing tests you have some setup work that needs to happen before tests run, and you have some finishing work that needs to happen after tests run. Jest provides helper functions to handle this.

It\textquotesingle{}s common when writing tests to need to perform setup work that needs to happen before tests run, and finishing work after tests run.

Because Jest executes all {\ttfamily describe} handlers in a test file {\itshape before} it executes any of the actual tests, it\textquotesingle{}s important to ensure setup and teardown work is done inside {\ttfamily before\texorpdfstring{$\ast$}{*}} and {\ttfamily after\texorpdfstring{$\ast$}{*}} handlers respectively, rather than inside the {\ttfamily describe} blocks.\hypertarget{md_node__modules_2eslint-plugin-jest_2docs_2rules_2require-hook_autotoc_md11476}{}\doxysection{\texorpdfstring{Rule details}{Rule details}}\label{md_node__modules_2eslint-plugin-jest_2docs_2rules_2require-hook_autotoc_md11476}
This rule flags any expression that is either at the toplevel of a test file or directly within the body of a {\ttfamily describe}, {\itshape except} for the following\+:


\begin{DoxyItemize}
\item {\ttfamily import} statements
\item {\ttfamily const} variables
\item {\ttfamily let} {\itshape declarations}, and initializations to {\ttfamily null} or {\ttfamily undefined}
\item Classes
\item Types
\item Calls to the standard Jest globals
\end{DoxyItemize}

This rule flags any function calls within test files that are directly within the body of a {\ttfamily describe}, and suggests wrapping them in one of the four lifecycle hooks.

Here is a slightly contrived test file showcasing some common cases that would be flagged\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{import\ \{\ database,\ isCity\ \}\ from\ '../database';}
\DoxyCodeLine{import\ \{\ Logger\ \}\ from\ '../../../src/Logger';}
\DoxyCodeLine{import\ \{\ loadCities\ \}\ from\ '../api';}
\DoxyCodeLine{}
\DoxyCodeLine{jest.mock('../api');}
\DoxyCodeLine{}
\DoxyCodeLine{const\ initializeCityDatabase\ =\ ()\ =>\ \{}
\DoxyCodeLine{\ \ database.addCity('Vienna');}
\DoxyCodeLine{\ \ database.addCity('San\ Juan');}
\DoxyCodeLine{\ \ database.addCity('Wellington');}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{const\ clearCityDatabase\ =\ ()\ =>\ \{}
\DoxyCodeLine{\ \ database.clear();}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{initializeCityDatabase();}
\DoxyCodeLine{}
\DoxyCodeLine{test('that\ persists\ cities',\ ()\ =>\ \{}
\DoxyCodeLine{\ \ expect(database.cities.length).toHaveLength(3);}
\DoxyCodeLine{\});}
\DoxyCodeLine{}
\DoxyCodeLine{test('city\ database\ has\ Vienna',\ ()\ =>\ \{}
\DoxyCodeLine{\ \ expect(isCity('Vienna')).toBeTruthy();}
\DoxyCodeLine{\});}
\DoxyCodeLine{}
\DoxyCodeLine{test('city\ database\ has\ San\ Juan',\ ()\ =>\ \{}
\DoxyCodeLine{\ \ expect(isCity('San\ Juan')).toBeTruthy();}
\DoxyCodeLine{\});}
\DoxyCodeLine{}
\DoxyCodeLine{describe('when\ loading\ cities\ from\ the\ api',\ ()\ =>\ \{}
\DoxyCodeLine{\ \ let\ consoleWarnSpy\ =\ jest.spyOn(console,\ 'warn');}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ loadCities.mockResolvedValue(['Wellington',\ 'London']);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ it('does\ not\ duplicate\ cities',\ async\ ()\ =>\ \{}
\DoxyCodeLine{\ \ \ \ await\ database.loadCities();}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ expect(database.cities).toHaveLength(4);}
\DoxyCodeLine{\ \ \});}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ it('logs\ any\ duplicates',\ async\ ()\ =>\ \{}
\DoxyCodeLine{\ \ \ \ await\ database.loadCities();}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ expect(consoleWarnSpy).toHaveBeenCalledWith(}
\DoxyCodeLine{\ \ \ \ \ \ 'Ignored\ duplicate\ cities:\ Wellington',}
\DoxyCodeLine{\ \ \ \ );}
\DoxyCodeLine{\ \ \});}
\DoxyCodeLine{\});}
\DoxyCodeLine{}
\DoxyCodeLine{clearCityDatabase();}

\end{DoxyCode}


Here is the same slightly contrived test file showcasing the same common cases but in ways that would be {\bfseries{not}} flagged\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{import\ \{\ database,\ isCity\ \}\ from\ '../database';}
\DoxyCodeLine{import\ \{\ Logger\ \}\ from\ '../../../src/Logger';}
\DoxyCodeLine{import\ \{\ loadCities\ \}\ from\ '../api';}
\DoxyCodeLine{}
\DoxyCodeLine{jest.mock('../api');}
\DoxyCodeLine{}
\DoxyCodeLine{const\ initializeCityDatabase\ =\ ()\ =>\ \{}
\DoxyCodeLine{\ \ database.addCity('Vienna');}
\DoxyCodeLine{\ \ database.addCity('San\ Juan');}
\DoxyCodeLine{\ \ database.addCity('Wellington');}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{const\ clearCityDatabase\ =\ ()\ =>\ \{}
\DoxyCodeLine{\ \ database.clear();}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{beforeEach(()\ =>\ \{}
\DoxyCodeLine{\ \ initializeCityDatabase();}
\DoxyCodeLine{\});}
\DoxyCodeLine{}
\DoxyCodeLine{test('that\ persists\ cities',\ ()\ =>\ \{}
\DoxyCodeLine{\ \ expect(database.cities.length).toHaveLength(3);}
\DoxyCodeLine{\});}
\DoxyCodeLine{}
\DoxyCodeLine{test('city\ database\ has\ Vienna',\ ()\ =>\ \{}
\DoxyCodeLine{\ \ expect(isCity('Vienna')).toBeTruthy();}
\DoxyCodeLine{\});}
\DoxyCodeLine{}
\DoxyCodeLine{test('city\ database\ has\ San\ Juan',\ ()\ =>\ \{}
\DoxyCodeLine{\ \ expect(isCity('San\ Juan')).toBeTruthy();}
\DoxyCodeLine{\});}
\DoxyCodeLine{}
\DoxyCodeLine{describe('when\ loading\ cities\ from\ the\ api',\ ()\ =>\ \{}
\DoxyCodeLine{\ \ let\ consoleWarnSpy;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ beforeEach(()\ =>\ \{}
\DoxyCodeLine{\ \ \ \ consoleWarnSpy\ =\ jest.spyOn(console,\ 'warn');}
\DoxyCodeLine{\ \ \ \ loadCities.mockResolvedValue(['Wellington',\ 'London']);}
\DoxyCodeLine{\ \ \});}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ it('does\ not\ duplicate\ cities',\ async\ ()\ =>\ \{}
\DoxyCodeLine{\ \ \ \ await\ database.loadCities();}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ expect(database.cities).toHaveLength(4);}
\DoxyCodeLine{\ \ \});}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ it('logs\ any\ duplicates',\ async\ ()\ =>\ \{}
\DoxyCodeLine{\ \ \ \ await\ database.loadCities();}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ expect(consoleWarnSpy).toHaveBeenCalledWith(}
\DoxyCodeLine{\ \ \ \ \ \ 'Ignored\ duplicate\ cities:\ Wellington',}
\DoxyCodeLine{\ \ \ \ );}
\DoxyCodeLine{\ \ \});}
\DoxyCodeLine{\});}
\DoxyCodeLine{}
\DoxyCodeLine{afterEach(()\ =>\ \{}
\DoxyCodeLine{\ \ clearCityDatabase();}
\DoxyCodeLine{\});}

\end{DoxyCode}
\hypertarget{md_node__modules_2eslint-plugin-jest_2docs_2rules_2require-hook_autotoc_md11477}{}\doxysection{\texorpdfstring{Options}{Options}}\label{md_node__modules_2eslint-plugin-jest_2docs_2rules_2require-hook_autotoc_md11477}
If there are methods that you want to call outside of hooks and tests, you can mark them as allowed using the {\ttfamily allowed\+Function\+Calls} option.


\begin{DoxyCode}{0}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ "{}jest/require-\/hook"{}:\ [}
\DoxyCodeLine{\ \ \ \ "{}error"{},}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ "{}allowedFunctionCalls"{}:\ ["{}enableAutoDestroy"{}]}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ ]}
\DoxyCodeLine{\}}

\end{DoxyCode}


Examples of {\bfseries{correct}} code when using {\ttfamily \{ "{}allowed\+Function\+Calls"{}\+: \mbox{[}"{}enable\+Auto\+Destroy"{}\mbox{]} \}} option\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{/*\ eslint\ jest/require-\/hook:\ ["{}error"{},\ \{\ "{}allowedFunctionCalls"{}:\ ["{}enableAutoDestroy"{}]\ \}]\ */}
\DoxyCodeLine{}
\DoxyCodeLine{import\ \{\ enableAutoDestroy,\ mount\ \}\ from\ '@vue/test-\/utils';}
\DoxyCodeLine{import\ \{\ initDatabase,\ tearDownDatabase\ \}\ from\ './databaseUtils';}
\DoxyCodeLine{}
\DoxyCodeLine{enableAutoDestroy(afterEach);}
\DoxyCodeLine{}
\DoxyCodeLine{beforeEach(initDatabase);}
\DoxyCodeLine{afterEach(tearDownDatabase);}
\DoxyCodeLine{}
\DoxyCodeLine{describe('Foo',\ ()\ =>\ \{}
\DoxyCodeLine{\ \ test('always\ returns\ 42',\ ()\ =>\ \{}
\DoxyCodeLine{\ \ \ \ expect(global.getAnswer()).toBe(42);}
\DoxyCodeLine{\ \ \});}
\DoxyCodeLine{\});}

\end{DoxyCode}
 